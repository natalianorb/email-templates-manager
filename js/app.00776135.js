(function(t){function e(e){for(var a,r,o=e[0],l=e[1],c=e[2],g=0,u=[];g<o.length;g++)r=o[g],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&u.push(i[r][0]),i[r]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);d&&d(e);while(u.length)u.shift()();return n.push.apply(n,c||[]),s()}function s(){for(var t,e=0;e<n.length;e++){for(var s=n[e],a=!0,o=1;o<s.length;o++){var l=s[o];0!==i[l]&&(a=!1)}a&&(n.splice(e--,1),t=r(r.s=s[0]))}return t}var a={},i={app:0},n=[];function r(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=a,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(s,a,function(e){return t[e]}.bind(null,a));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/email-templates-manager/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var d=l;n.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"0104":function(t,e,s){},"0891":function(t,e,s){},2414:function(t,e,s){},"29a6":function(t,e,s){"use strict";var a=s("0104"),i=s.n(a);i.a},"2b36":function(t,e,s){"use strict";var a=s("7005"),i=s.n(a);i.a},"2ce1":function(t,e,s){},3470:function(t,e,s){"use strict";var a=s("2414"),i=s.n(a);i.a},"3b0d":function(t,e,s){"use strict";var a=s("ad5e"),i=s.n(a);i.a},4467:function(t,e,s){"use strict";var a=s("2ce1"),i=s.n(a);i.a},"50c8":function(t,e,s){"use strict";var a=s("ab28"),i=s.n(a);i.a},"561d":function(t,e,s){"use strict";var a=s("920f"),i=s.n(a);i.a},"56d7":function(t,e,s){"use strict";s.r(e);var a=s("2b0e"),i=s("1dce"),n=s.n(i),r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("router-view")],1)},o=[],l={name:"app"},c=l,d=(s("7c55"),s("2877")),g=Object(d["a"])(c,r,o,!1,null,null,null),u=g.exports,p=s("2f62"),h=s("bc3a"),m=s.n(h);class _{constructor(t={id:"",title:""}){const{id:e,title:s}=t;this.id=e,this.title=s}}var v=_;const y="https://simple-api.sandbox.movavi.com/api/v1/",b=["id","title","parent","children","messages"],f=t=>t.charAt(0).toUpperCase()+t.slice(1);class C extends v{constructor(t={id:"",title:"",parent:"",children:[],messages:[]}){super(t),this.parent=t.parent||null,this.children=new Set(t.children),this.messages=new Set(t.messages)}create(t){return m.a.post(y,{jsonrpc:"2.0",method:"createCategory",id:"test",params:{data:t}}).then(t=>t.data&&t.data.result)}delete(){return m.a.post(y,{jsonrpc:"2.0",method:"deleteCategory",id:"test",params:{conditions:["id","=",this.id]}}).then(t=>t.data&&t.data.result)}update(t){const{id:e}=t;return e?m.a.post(y,{jsonrpc:"2.0",method:"updateCategory",id:"test",params:{conditions:["id","=",t.id],data:t}}).then(t=>t.data&&t.data.result):Promise.reject(new Error("save requires id"))}static getById(t={}){const{id:e}=t;return e?m.a.post(y,{jsonrpc:"2.0",method:"readCategory",id:"test",params:{conditions:["id","=",e],fields:b}}).then(t=>t.data&&t.data.result&&t.data.result.data&&t.data.result.data[0]):Promise.reject(new Error("getById requires id"))}static getByTitle({perPage:t=10,title:e,page:s}){return e?m.a.post(y,{jsonrpc:"2.0",method:"readCategory",id:"test",params:{conditions:{operator:"or",operand_1:{operator:"or",operand_1:["title","LIKE",`${e.toLowerCase()}%`],operand_2:["title","LIKE",`${e.toUpperCase()}%`]},operand_2:["title","LIKE",`${f(e)}%`]},page:s,perPage:t,fields:b}}).then(t=>t.data&&t.data.result&&t.data.result.data&&t.data.result.data):Promise.reject(new Error("getByTitle requires title"))}static get({perPage:t=10,page:e,conditions:s=["id","IS NOT NULL"]}){return m.a.post(y,{jsonrpc:"2.0",method:"readCategory",id:"test",params:{conditions:s,page:e,perPage:t,fields:b}}).then(t=>t.data&&t.data.result)}}var w=C;a["a"].use(p["a"]);var P=new p["a"].Store({state:{category:{}},mutations:{SET_CATEGORY(t,e){t.category=new w(e)}},actions:{setCategory({commit:t},e){t("SET_CATEGORY",e)}}}),E=s("8c4f"),x=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"categories container"},[s("h1",[t._v("Категории")]),s("div",{staticClass:"header"},[s("router-link",{attrs:{to:{name:"messages"}}},[t._v("К сообщениям")]),s("router-link",{attrs:{to:{name:"categoryEdit",params:{id:"0"}}}},[t._v("\n      Создать категорию\n    ")])],1),s("Filters",{attrs:{title:t.title,"parent-title":t.parentTitle,"has-counter":!0,"messages-count":t.messagesCount},on:{"update:title":function(e){t.title=e},"update:parentTitle":function(e){t.parentTitle=e},"update:parent-title":function(e){t.parentTitle=e},"update:messagesCount":function(e){t.messagesCount=e},"update:messages-count":function(e){t.messagesCount=e}}}),s("CategoriesTable",{attrs:{categories:t.filteredCategories,"sort-by":t.sortBy,ascending:t.ascending},on:{edit:t.goEditCategory,select:t.showCategory,sort:t.setSorting}}),s("paginate",{directives:[{name:"show",rawName:"v-show",value:t.totalPages,expression:"totalPages"}],attrs:{"page-count":t.totalPages,"click-handler":t.getPage,"prev-text":"Пред.","next-text":"След.","container-class":"pagination","page-class":"pagination__page"},model:{value:t.page,callback:function(e){t.page=e},expression:"page"}})],1)},$=[],S=s("8832"),T=s.n(S),k=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"categories-table__table-wrapper"},[s("div",{staticClass:"categories-table__overflow"},[s("table",{staticClass:"categories-table__table"},[s("tr",{staticClass:"categories-table__head"},[s("td",{staticClass:"categories-table__title"},[s("button",{class:["categories-table__sort",{sorted:"title"===t.sortBy,ascending:t.ascending}],attrs:{type:"button"},on:{click:function(e){return t.$emit("sort",{sortBy:"title",ascending:!t.ascending})}}},[t._v("\n            Название\n          ")])]),s("td",[s("button",{class:["categories-table__sort",{sorted:"parentTitle"===t.sortBy,ascending:t.ascending}],attrs:{type:"button"},on:{click:function(e){return t.$emit("sort",{sortBy:"parentTitle",ascending:!t.ascending})}}},[t._v("\n            Родительская категория\n          ")])]),s("td",{staticClass:"categories-table__children-column"},[s("button",{class:["categories-table__sort",{sorted:"children"===t.sortBy,ascending:t.ascending}],attrs:{type:"button"},on:{click:function(e){return t.$emit("sort",{sortBy:"children",ascending:!t.ascending})}}},[t._v("\n            Подкатегории\n          ")])]),s("td",[s("button",{class:["categories-table__sort",{sorted:"messages"===t.sortBy,ascending:t.ascending}],attrs:{type:"button"},on:{click:function(e){return t.$emit("sort",{sortBy:"messages",ascending:!t.ascending})}}},[t._v("\n            Сообщения\n          ")])]),s("td")]),t._l(t.categories,function(e){return s("tr",{key:e.id,staticClass:"category-view",on:{click:function(s){return t.onSelect(e.id)}}},[s("td",{staticClass:"category-view__title"},[t._v("\n          "+t._s(e.title)+"\n        ")]),s("td",{staticClass:"category-view__parent"},[e.parent?s("div",[t._v(t._s(e.parent.title))]):t._e()]),s("td",{staticClass:"category-view__children"},[e.children?s("div",[t._v("\n            "+t._s(e.children.size||e.children.length)+"\n          ")]):t._e()]),s("td",{staticClass:"category-view__messages"},[e.messages?s("div",[t._v("\n            "+t._s(e.messages.size||e.messages.length)+"\n          ")]):t._e()]),s("td",{staticClass:"category-view__buttons"},[s("router-link",{staticClass:"category-view__save",attrs:{to:{name:"categoryEdit",params:{id:""+e.id}}}},[t._v("\n            Изменить\n          ")])],1)])})],2)])])},j=[],O={props:{categories:{type:Array,default(){return[]}},sortBy:{type:String,default:"title"},ascending:{type:Boolean,default:!0}},methods:{onEdit(t){this.$emit("edit",t)},onSelect(t){this.$emit("select",t)}}},M=O,B=(s("ebd5"),Object(d["a"])(M,k,j,!1,null,null,null)),L=B.exports,I=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("form",{staticClass:"filters"},[s("div",{staticClass:"filters__header"},[t._v("Фильтры для текущей страницы:")]),s("div",{staticClass:"filters__body"},[s("label",{staticClass:"filters__label"},[s("span",[t._v("Название")]),s("input",{staticClass:"filters__input",attrs:{type:"text",placeholder:"Название"},domProps:{value:t.title},on:{input:t.onInputTitle}})]),s("label",{staticClass:"filters__label _parent"},[s("span",[t._v("Родительская категория")]),s("input",{staticClass:"filters__input",attrs:{type:"text",placeholder:"Родительская категория"},domProps:{value:t.parentTitle},on:{input:t.onInputParent}})]),t.hasCounter?s("label",{staticClass:"filters__label _counter"},[s("span",[t._v("Количество сообщений")]),s("input",{staticClass:"filters__input _count",attrs:{placeholder:"",type:"number",min:"0",step:"1"},domProps:{value:t.messagesCount},on:{input:t.onInputCount}})]):t._e()])])},V=[],N={name:"Filters",props:{title:{type:String,default:""},maxTitleLength:{type:Number,default:255},parentTitle:{type:String,default:""},maxParentLength:{type:Number,default:255},messagesCount:{type:Number},hasCounter:{type:Boolean,default:!1}},methods:{onInputTitle(t){const e=t.target.value.trim().slice(0,this.maxTitleLength);t.target.value=e,this.$emit("update:title",e)},onInputParent(t){const e=t.target.value.trim().slice(0,this.maxParentLength);t.target.value=e,this.$emit("update:parentTitle",e)},onInputCount(t){const{value:e}=t.target;this.$emit("update:messagesCount",e.length?+e:null)}}},D=N,z=(s("4467"),Object(d["a"])(D,I,V,!1,null,"d6599868",null)),q=z.exports;function A(t,e){const s=e.split(".");let a=t;for(let i=0;i<s.length;++i){if(!a[s[i]])return a[s[i]];a=a[s[i]]}return a}function F(t,e,s){const a=A(t,s),i=A(e,s);return a?i&&a.toString().toLowerCase()<i.toString().toLowerCase()?-1:1:-1}var U={name:"Categories",components:{CategoriesTable:L,Filters:q,Paginate:T.a},data(){return{categories:[],page:0,totalPages:0,title:"",parentTitle:"",messagesCount:null,sortBy:"title",ascending:!0}},computed:{filteredCategories(){const{title:t,parentTitle:e,messagesCount:s}=this,a=t.toLowerCase(),i=e.toLowerCase();let n;switch(this.sortBy){case"title":n="title";break;case"parentTitle":n="parent.title";break;case"children":n="children.size";break;case"messages":n="messages.size";break}return this.categories.filter(t=>{let e=!0;return a&&(e=t.title.toLowerCase().includes(a)),i&&(e=e&&t.parent&&t.parent.title.toLowerCase().includes(i)),"number"===typeof s&&(e=e&&t.messages.size===s),e}).sort((t,e)=>this.ascending?F(t,e,n):F(e,t,n))}},created(){this.getCategories()},methods:{...Object(p["b"])(["setCategory"]),goEditCategory(t){this.$router.push({name:"categoryEdit",params:{id:`${t}`}})},getCategories(t={}){let e;return w.get(t).then(({data:t,totalPages:e,page:s})=>{this.categories=t.map(t=>new w(t)),this.totalPages=e,this.page=s}).then(()=>{return e=this.categories.filter(t=>!!t.parent),w.get({conditions:["id","IN",[...new Set(e.map(t=>t.parent.id))]]})}).then(({data:t})=>{e.forEach(e=>{const s=t.find(t=>t.id===e.parent.id),a=this.categories.findIndex(t=>t.id===e.id);this.$set(this.categories,a,new w(Object.assign({},e,{parent:s})))})})},getPage(t){this.getCategories({page:t})},setSorting({sortBy:t,ascending:e}){this.sortBy=t,this.ascending=e},showCategory(t){const e=this.categories.find(e=>e.id===t);this.setCategory(e),this.$router.push({name:"categoryMessages",params:{id:`${t}`}})}}},K=U,G=(s("2b36"),Object(d["a"])(K,x,$,!1,null,"41758223",null)),J=G.exports,R=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{key:t.id,staticClass:"category-edit container"},[t.isEditing?s("h2",[t._v(t._s("0"===t.id?"Создание":"Редактирование")+" категории")]):s("h2",[t._v("Категория")]),s("h1",{staticClass:"category-edit__page-title"},[t._v(t._s(t.category.title))]),s("div",{staticClass:"category-edit__top"},[s("div",{staticClass:"category-edit__title"},[s("label",[s("div",[t._v("Название")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"category-edit__input",attrs:{disabled:!t.isEditing},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}}),s("div",{class:["error",{visible:t.$v&&t.$v.title&&t.$v.title.$invalid}]},[t._v("\n          Слишком длинное название\n        ")])])]),s("div",{staticClass:"category-edit__parent"},[t.isEditing?s("SearchSelect",{attrs:{"searching-value":t.parentTitle,"searching-prop":"title",options:t.parents,required:!1,label:"Название родительской категории"},on:{input:t.onInputParent,blur:t.onBlur,select:t.onSelectParent,error:function(e){t.parentError=e}},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",[t._v("\n            "+t._s(e.option.title)+"\n          ")])]}}],null,!1,227483608)}):s("div",[s("span",[t._v("Родительская категория:")]),s("div",[t._v(t._s(t.category.parent&&t.category.parent.title))])]),s("div",{class:["error",{visible:!!t.parentError}]},[t._v(t._s(t.parentError))])],1)]),s("div",{staticClass:"category-edit__children"},[t.children?[s("h2",[t._v("\n        Количество подкатегорий: "+t._s(t.children.length)+"\n      ")]),t.children.length?s("CategoriesTable",{attrs:{categories:t.children},on:{edit:t.goEditCategory}}):t._e()]:t._e()],2),s("div",{staticClass:"category-edit__messages"},[t.category.messages?s("h2",[t._v("Количество сообщений: "+t._s(t.category.messages.size))]):t._e(),"0"!==t.id?s("router-link",{attrs:{to:{name:"categoryMessages",params:{id:t.id}}}},[t._v("\n      К сообщениям категории\n    ")]):t._e()],1),t.isEditing?s("div",{staticClass:"category-edit__buttons"},[s("button",{staticClass:"category-edit__save",attrs:{disabled:t.saveDisabled,type:"button"},on:{click:function(e){return e.stopPropagation(),t.debouncedSave(e)}}},[t._v("\n      Сохранить\n    ")]),t.category.id?s("button",{staticClass:"category-edit__save",attrs:{type:"button"},on:{click:function(e){t.isModalVisible=!0}}},[t._v("\n      Удалить\n    ")]):t._e(),s("button",{staticClass:"category-edit__cancel",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),t.onCancel(e)}}})]):s("div",[s("button",{staticClass:"category-edit__edit",attrs:{type:"button"},on:{click:function(e){e.stopPropagation(),t.isEditing=!0}}},[t._v("\n      Изменить\n    ")])]),s("simple-modal",{staticClass:"modal",attrs:{size:"small",title:"Действительно удалить?"},model:{value:t.isModalVisible,callback:function(e){t.isModalVisible=e},expression:"isModalVisible"}},[t.isSecondConfirmVisible?s("template",{slot:"body"},[s("div",[t._v("Данная категория содержит сообщения или другие категории")]),s("div",{staticClass:"modal__buttons"},[s("button",{attrs:{type:"button"},on:{click:t.debouncedDelete}},[t._v("Все равно удалить")])])]):s("template",{slot:"body"},[s("div",[t._v("Пожалуйста, подтвердите удаление")]),s("div",{staticClass:"modal__buttons"},[s("button",{attrs:{type:"button"},on:{click:t.doubleCheck}},[t._v("Удалить")])])])],2)],1)},Y=[],H=s("2ef0"),Q=s("2976"),W=s.n(Q),X=s("b5ae"),Z=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"search-select"},[s("label",[s("span",[t._v(t._s(t.label))]),s("input",{staticClass:"search-select__input",attrs:{placeholder:t.placeholder},domProps:{value:t.searchingValue},on:{focus:t.showDropdown,input:t.onInput,blur:t.onBlur}})]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.visible&&t.filteredOptions&&t.filteredOptions.length,expression:"visible && filteredOptions && filteredOptions.length"}],staticClass:"search-select__dropdown",attrs:{tabindex:"0"},on:{blur:t.closeDropdown,scroll:function(e){t.isScrolling=!0}}},t._l(t.filteredOptions,function(e,a){return s("div",{key:a,class:["search-select__item"],on:{mousedown:function(s){return t.select(e)}}},[t._t("default",[t._v("\n        "+t._s(e)+"\n      ")],{option:e})],2)}),0)])},tt=[];function et(t,e){const s=e.split(".");let a=t;for(let i=0;i<s.length;++i){if(!a[s[i]])return a[s[i]];a=a[s[i]]}return a}var st={model:{prop:"searchingValue",event:"input"},props:{label:{type:String,default:""},searchingValue:{type:String,default:""},searchingProp:{type:String,default:""},options:{type:Array,default(){return[]}},required:{type:Boolean,default:!0},placeholder:{type:String,default:""},maxLength:{type:Number,default:255}},data(){return{isScrolling:!1,visible:!1,rules:{maxLength:t=>!t||t.length<=this.maxLength},selected:null}},computed:{filteredOptions(){if(!this.searchingValue||!this.options)return[];const t=this.searchingValue.trim().toLowerCase();return this.searchingProp?this.options.filter(e=>et(e,this.searchingProp).toLowerCase().includes(t)):this.options.filter(e=>e.toLowerCase().includes(t))}},methods:{closeDropdown(){this.visible=!1,this.isScrolling=!1},onBlur(t){this.validate(t.target.value),this.$emit("blur",t),setTimeout(()=>{this.isScrolling||this.closeDropdown()},50)},onInput(t){const{value:e}=t.target;this.visible=!0,this.validate(e),this.$emit("input",e)},select(t){this.closeDropdown(),this.$emit("select",t)},validate(t){return this.required&&!t?(this.$emit("error","Необходимо заполнить все обязательные поля"),!1):this.rules.maxLength(t)?(this.$emit("error",""),!0):(this.$emit("error","Слишком длинный текст"),!1)},showDropdown(){this.searchingValue&&this.filteredOptions.length&&(this.visible=!0)}}},at=st,it=(s("561d"),Object(d["a"])(at,Z,tt,!1,null,null,null)),nt=it.exports,rt={data(){return{parentError:"",parent:null,parents:[],parentTitle:""}},created(){this.init&&this.init(),this.debouncedsearchParent=Object(H["debounce"])(this.searchParent,300)},methods:{onBlur(t){this.parentError||t.target&&t.target.value&&!this.parent&&(this.parentError="Проверьте корректность ввода")},onInputParent(t){this.parentTitle=t.trim(),this.parent=null,this.parentError||this.debouncedsearchParent(this.parentTitle)},onSelectParent(t){this.parentError="",this.parentTitle=t.title,this.parent=t}}},ot={mixins:[rt],components:{CategoriesTable:L,SearchSelect:nt,SimpleModal:W.a},props:{id:{type:String,required:!0}},validations(){return{title:{maxLength:Object(X["maxLength"])(255)}}},data(){return{title:"",children:[],messages:[],isModalVisible:!1,isSecondConfirmVisible:!1,isEditing:!0}},computed:{...Object(p["c"])({category:t=>t.category}),saveDisabled(){if(!this.$v)return!0;const{$v:t}=this;return t&&t.title&&t.title.$invalid||!!this.parentError},showNextConfirm(){return this.category&&this.category.children&&this.category.messages&&(this.category.children.size||this.category.messages.size)}},watch:{id:{deep:!0,handler(t,e){"0"!==e&&this.initializeCategory()}},category:{deep:!0,handler(t,e){!t.parent||!t.parent.title||e.parent&&e.parent.title||(this.parent=t.parent,this.parentTitle=t.parent.title)}}},created(){this.debouncedSave=Object(H["debounce"])(this.saveCategory,300),this.debouncedDelete=Object(H["debounce"])(this.deleteCategory,300),this.initializeCategory()},methods:{...Object(p["b"])(["setCategory"]),initializeCategory(){w.getById({id:this.id}).then(t=>{this.setCategory(new w(t));const{title:e,parent:s,messages:a}=this.category;this.title=e,this.messages=a,s?this.getParent():(this.parent=null,this.parentTitle=""),this.getChildren()})},doubleCheck(){!this.showNextConfirm||this.isSecondConfirmVisible?this.deleteCategory():this.isSecondConfirmVisible=!0},deleteCategory(){this.category.delete().then(()=>{this.isModalVisible=!1,this.isSecondConfirmVisible=!1,this.$router.go(-1)})},getChildren(){const t=[];return this.category.children.forEach(e=>{t.push(w.getById({id:e.id}))}),Promise.all(t).then(t=>{this.children=t,this.children.forEach(t=>{t.parent=this.category})})},getParent(){this.category&&this.category.parent&&w.getById({id:this.category.parent.id}).then(t=>{this.parent=new w(t),this.parentTitle=this.parent.title})},goEditCategory(t){this.$router.push({name:"categoryEdit",params:{id:`${t}`}})},onCancel(){this.$router.go(-1)},saveCategory(){const{id:t,title:e,parent:s,children:a,messages:i}=this,n={id:t,title:e,children:a,messages:i,parent:s},r={id:t,title:e,messages:i};if(r.parent=s?{id:s.id}:null,r.children=a.length?a.map(t=>({id:t.id})):[],"0"!==this.id)return void this.category.update(r).then(()=>{this.setCategory(n),this.isEditing=!1});const o=new w(n);o.create(r).then(t=>{this.isEditing=!1;const e=t["Primary key"];n.id=e.id,this.setCategory(n),this.$router.replace({name:"categoryEdit",params:{id:`${e.id}`}})})},searchParent(t){t&&w.getByTitle({title:t}).then(t=>{this.parents=t.filter(t=>t.id!==this.category.id)})}}},lt=ot,ct=(s("3470"),Object(d["a"])(lt,R,Y,!1,null,null,null)),dt=ct.exports,gt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"messages container"},[t.id?s("h1",{staticClass:"messages__title"},[t._v("Сообщения категории "+t._s(t.category.title))]):s("h1",[t._v("Сообщения")]),s("div",{staticClass:"header"},[s("router-link",{attrs:{to:{name:"categories"}}},[t._v("К категориям")]),s("router-link",{attrs:{to:{name:"messageEdit",params:{id:"0"}}}},[t._v("Создать сообщение")])],1),t.messages.length?s("Filters",{attrs:{title:t.title,"parent-title":t.parentTitle,"max-title-length":1024,"messages-count":t.messagesCount},on:{"update:title":function(e){t.title=e},"update:parentTitle":function(e){t.parentTitle=e},"update:parent-title":function(e){t.parentTitle=e},"update:messagesCount":function(e){t.messagesCount=e},"update:messages-count":function(e){t.messagesCount=e}}}):t._e(),t.messages.length?s("table",{staticClass:"messages__table"},[s("tr",{staticClass:"messages__head"},[s("td",[s("button",{class:["messages__sort",{sorted:"title"===t.sortBy,ascending:t.ascending}],attrs:{type:"button"},on:{click:function(e){t.sortBy="title",t.ascending=!t.ascending}}},[t._v("\n          Название\n        ")])]),s("td",[s("button",{class:["messages__sort",{sorted:"parentTitle"===t.sortBy,ascending:t.ascending}],attrs:{type:"button"},on:{click:function(e){t.sortBy="parentTitle",t.ascending=!t.ascending}}},[t._v("\n          Родительская категория\n        ")])]),s("td",{staticClass:"messages__body-column"},[s("button",{class:["messages__sort",{sorted:"body"===t.sortBy,ascending:t.ascending}],attrs:{type:"button"},on:{click:function(e){t.sortBy="body",t.ascending=!t.ascending}}},[t._v("\n          Содержимое\n        ")])]),s("td")]),t._l(t.filteredMessages,function(e){return s("MessageView",{key:e.id,tag:"tr",attrs:{"is-change-disabled":!1,message:e},on:{edit:function(s){return t.$router.push({name:"messageEdit",params:{id:""+e.id}})}}})})],2):t._e(),s("paginate",{directives:[{name:"show",rawName:"v-show",value:t.totalPages,expression:"totalPages"}],attrs:{"page-count":t.totalPages,"click-handler":t.getPage,"prev-text":"Пред.","next-text":"След.","container-class":"pagination","page-class":"pagination__page"},model:{value:t.page,callback:function(e){t.page=e},expression:"page"}})],1)},ut=[],pt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("tr",{staticClass:"message-view"},[s("td",{staticClass:"message-view__title"},[t._v("\n    "+t._s(t.message.title)+"\n  ")]),s("td",{staticClass:"message-view__parent"},[t._v("\n    "+t._s(t.message.category.title)+"\n  ")]),s("td",{staticClass:"message-view__text"},[s("div",{staticClass:"message-view__textarea"},[t._v(t._s(t.message.body))])]),s("td",{staticClass:"message-view__buttons"},[s("router-link",{directives:[{name:"show",rawName:"v-show",value:!t.isChangeDisabled,expression:"!isChangeDisabled"}],staticClass:"message-view__save",attrs:{to:{name:"messageEdit",params:{id:""+t.message.id}}}},[t._v("\n      Изменить\n    ")])],1)])},ht=[],mt={props:{message:{type:Object,default(){return{title:""}}},isChangeDisabled:{type:Boolean,default:!1}},methods:{onEdit(){this.$emit("edit",this.message.id)}}},_t=mt,vt=(s("3b0d"),Object(d["a"])(_t,pt,ht,!1,null,"6d3cfcb2",null)),yt=vt.exports;class bt extends v{constructor(t={id:"",title:"",body:"",category:""}){super(t),this.body=t.body||"",this.category=t.category}create(t){return m.a.post(y,{jsonrpc:"2.0",method:"createMessage",id:"test",params:{data:t}}).then(t=>t.data&&t.data.result)}delete(){return m.a.post(y,{jsonrpc:"2.0",method:"deleteMessage",id:"test",params:{conditions:["id","=",this.id]}}).then(t=>t.data&&t.data.result)}static getById(t={perPage:10}){const{id:e}=t;return e?m.a.post(y,{jsonrpc:"2.0",method:"readMessage",id:"test",params:{conditions:["id","=",e]}}).then(t=>t.data&&t.data.result&&t.data.result.data&&t.data.result.data[0]):Promise.reject(new Error("get Message by id requires id"))}update(t){const{id:e}=t;return e?m.a.post(y,{jsonrpc:"2.0",method:"updateMessage",id:"test",params:{conditions:["id","=",t.id],data:t}}).then(t=>t.data&&t.data.result):Promise.reject(new Error("save requires id"))}static get({perPage:t=10,page:e,conditions:s=["id","IS NOT NULL"]}){return m.a.post(y,{jsonrpc:"2.0",method:"readMessage",id:"test",params:{conditions:s,page:e,perPage:t}}).then(t=>t.data&&t.data.result)}static getMessagesOf({perPage:t=10,page:e,categoryId:s}){return s?m.a.post(y,{jsonrpc:"2.0",method:"readMessage",id:"test",params:{conditions:["category","=",s],page:e,perPage:t}}).then(t=>t.data&&t.data.result):Promise.reject(new Error("getMessagesOf requires Category id"))}}var ft=bt,Ct={name:"Messages",components:{MessageView:yt,Filters:q,Paginate:T.a},props:{id:{type:String}},data(){return{messages:[],page:0,totalPages:0,title:"",parentTitle:"",messagesCount:null,sortBy:"title",ascending:!0}},computed:{...Object(p["c"])({category:t=>t.category}),filteredMessages(){const{title:t,parentTitle:e,messagesCount:s}=this,a=t.toLowerCase(),i=e.toLowerCase();let n;switch(this.sortBy){case"title":n="title";break;case"parentTitle":n="parent.title";break;case"body":n="body";break}return this.messages.filter(t=>{let e=!0;return a&&(e=t.title.toLowerCase().includes(a)),i&&(e=e&&t.category&&t.category.title.toLowerCase().includes(i)),"number"===typeof s&&(e=e&&t.messages.size===s),e}).sort((t,e)=>this.ascending?F(t,e,n):F(e,t,n))}},created(){this.id?w.getById({id:this.id}).then(t=>{this.setCategory(new w(t)),this.getCategoryMessages()}):this.getMessages()},methods:{...Object(p["b"])(["setCategory"]),getCategoryMessages(t){const e=this.category.id;e&&ft.getMessagesOf({page:t,categoryId:e}).then(({data:t,totalPages:e,page:s})=>{this.messages=t.map(t=>{return t.category=Object.assign({},this.category),new ft(t)}),this.totalPages=e,this.page=s})},getMessages(t){ft.get({page:t}).then(({data:t,totalPages:e,page:s})=>{this.messages=t.map(t=>new ft(t)),this.totalPages=e,this.page=s;const a=t.map(t=>t.category&&t.category.id);return w.get({conditions:["id","IN",[...new Set(a)]]})}).then(({data:t})=>{this.messages.forEach((e,s)=>{const a=t.find(t=>t.id===e.category.id);this.$set(this.messages,s,new ft(Object.assign({},e,{category:a})))})})},getPage(t){this.id?this.getCategoryMessages(t):this.getMessages(t)}}},wt=Ct,Pt=(s("50c8"),Object(d["a"])(wt,gt,ut,!1,null,"26efb2de",null)),Et=Pt.exports,xt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"message-edit container"},[t.isEditing?s("h2",[t._v(t._s("0"===t.id?"Создание":"Редактирование")+" сообщения")]):s("h2",[t._v("Сообщение")]),t.message?s("h1",{staticClass:"message-edit__page-title"},[t._v(t._s(t.message.title))]):t._e(),s("div",{staticClass:"header"},[t.message&&t.message.category&&"0"!==t.id?s("router-link",{attrs:{to:{name:"categoryMessages",params:{id:""+t.message.category.id}}}},[t._v("\n      К сообщениям категории\n    ")]):t._e()],1),s("div",{staticClass:"message-edit__title"},[s("label",[s("div",[t._v("Название")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"message-edit__input",attrs:{disabled:!t.isEditing,type:"text"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}}),s("div",{class:["error",{visible:t.$v&&t.$v.title&&t.$v.title.$invalid}]},[t._v("\n        Слишком длинное название\n      ")])])]),s("div",{staticClass:"message-edit__parent"},[t.isEditing?[s("SearchSelect",{attrs:{"searching-value":t.parentTitle,"searching-prop":"title",options:t.parents,required:!1,label:"Категория",placeholder:"Название"},on:{input:t.onInputParent,blur:t.onBlur,select:t.onSelectParent,error:function(e){t.parentError=e}},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",[t._v("\n            "+t._s(e.option.title)+"\n          ")])]}}],null,!1,227483608)}),s("div",{class:["error",{visible:!!t.parentError}]},[t._v(t._s(t.parentError))])]:[s("label",[s("div",[t._v("Категория")]),t.message&&t.message.category?s("input",{attrs:{disabled:""},domProps:{value:t.message.category.title}}):t._e()])]],2),s("div",{staticClass:"message-edit__text"},[s("label",[s("div",[t._v("Текст")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.body,expression:"body"}],staticClass:"message-edit__textarea",attrs:{disabled:!t.isEditing},domProps:{value:t.body},on:{input:function(e){e.target.composing||(t.body=e.target.value)}}})])]),s("div",{staticClass:"message-edit__buttons"},[t.isEditing?[s("button",{staticClass:"message-edit__save",attrs:{disabled:!!t.parentError,type:"button"},on:{click:function(e){return e.stopPropagation(),t.debouncedSave(e)}}},[t._v("\n        Сохранить\n      ")]),"0"!==t.id?s("button",{staticClass:"message-edit__save",attrs:{type:"button"},on:{click:function(e){e.stopPropagation(),t.isModalVisible=!0}}},[t._v("\n        Удалить\n      ")]):t._e(),s("button",{staticClass:"message-edit__cancel",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),t.onCancel(e)}}})]:s("button",{staticClass:"message-edit__save",attrs:{type:"button"},on:{click:function(e){e.stopPropagation(),t.isEditing=!0}}},[t._v("\n      Изменить\n    ")])],2),s("simple-modal",{staticClass:"modal",attrs:{size:"small",title:"Действительно удалить?"},model:{value:t.isModalVisible,callback:function(e){t.isModalVisible=e},expression:"isModalVisible"}},[s("template",{slot:"body"},[s("div",[t._v("Пожалуйста, подтвердите удаление")]),s("div",{staticClass:"modal__buttons"},[s("button",{attrs:{type:"button"},on:{click:t.debouncedDelete}},[t._v("Удалить")])])])],2)],1)},$t=[],St={props:{id:{type:String,required:!0}},mixins:[rt],components:{SearchSelect:nt,SimpleModal:W.a},validations(){return{title:{maxLength:Object(X["maxLength"])(1024)}}},data(){return{title:"",body:"",category:"",message:null,isModalVisible:!1,isEditing:!0}},computed:{saveDisabled(){if(!this.$v)return!0;const{$v:t}=this;return t&&t.title&&t.title.$invalid||!!this.parentError}},created(){this.debouncedSave=Object(H["debounce"])(this.saveMessage,300),this.debouncedDelete=Object(H["debounce"])(this.deleteMessage,300)},methods:{init(){ft.getById({id:this.id}).then(t=>{this.message=new ft(t);const{title:e,category:s,body:a}=this.message;this.title=e,this.body=a,s?this.getParent():(this.parent=null,this.parentTitle="")})},deleteMessage(){this.message.delete().then(()=>{this.isModalVisible=!1,this.$router.go(-1)})},getParent(){this.message&&this.message.category&&w.getById({id:this.message.category.id}).then(t=>{this.parent=new w(t),this.parentTitle=this.parent.title})},onCancel(){this.$router.go(-1)},saveMessage(){const{id:t,title:e,parent:s,body:a,message:i}=this,n=s&&s.id,r={id:t,title:e,body:a};r.category={id:n},i.id?i.update(r).then(()=>{this.isEditing=!1,i.category=s}):i.create(r).then(t=>{const e=t["Primary key"];i.id=e&&e.id,this.isEditing=!1,i.category=s,this.$router.replace({name:"messageEdit",params:{id:`${e.id}`}})})},searchParent(t){t&&w.getByTitle({title:t}).then(t=>{this.parents=t})}}},Tt=St,kt=(s("29a6"),Object(d["a"])(Tt,xt,$t,!1,null,"21f701de",null)),jt=kt.exports;a["a"].use(E["a"]);var Ot=new E["a"]({routes:[{path:"/",name:"home",component:J},{path:"/categories",name:"categories",component:J},{path:"/categoryMessages/:id",name:"categoryMessages",component:Et,props:!0},{path:"/categoryEdit/:id",name:"categoryEdit",component:dt,props:!0},{path:"/messages",name:"messages",component:Et},{path:"/messageEdit/:id",name:"messageEdit",component:jt,props:!0}]});a["a"].config.productionTip=!1,a["a"].use(n.a),new a["a"]({store:P,router:Ot,render(t){return t(u)}}).$mount("#app")},"5c48":function(t,e,s){},7005:function(t,e,s){},"7c55":function(t,e,s){"use strict";var a=s("5c48"),i=s.n(a);i.a},"920f":function(t,e,s){},ab28:function(t,e,s){},ad5e:function(t,e,s){},ebd5:function(t,e,s){"use strict";var a=s("0891"),i=s.n(a);i.a}});
//# sourceMappingURL=app.00776135.js.map